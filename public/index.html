<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CRUD User - Vue 2 + API</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background: #f5f5f5; }
    input, button { margin: 5px 0; padding: 6px; }
    .form-container { margin-bottom: 20px; }
    .btn { cursor: pointer; padding: 6px 12px; border: none; border-radius: 4px; }
    .btn-add { background: #28a745; color: white; }
    .btn-edit { background: #007bff; color: white; }
    .btn-delete { background: #dc3545; color: white; }
  </style>
</head>
<body>
  <div id="app">
    <h2>CRUD User (Vue 2 + Node.js API)</h2>

    <!-- Form Tambah / Edit -->
    <div class="form-container">
      <input type="text" v-model="form.name" placeholder="Name">
      <input type="email" v-model="form.email" placeholder="Email">
      <input type="number" v-model="form.age" placeholder="Age">
      <button class="btn btn-add" v-if="!isEdit" @click="addUser">Add User</button>
      <button class="btn btn-edit" v-if="isEdit" @click="updateUser">Update User</button>
      <button v-if="isEdit" @click="cancelEdit">Cancel</button>
    </div>

    <!-- Table Users -->
    <table>
      <thead>
        <tr>
          <th>Name</th><th>Email</th><th>Age</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="user in users" :key="user._id">
          <td>{{ user.name }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.age }}</td>
          <td>
            <button class="btn btn-edit" @click="editUser(user)">Edit</button>
            <button class="btn btn-delete" @click="deleteUser(user._id)">Delete</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        users: [],
        form: { name: '', email: '', age: '' },
        isEdit: false,
        editId: null,
        apiUrl: "http://localhost:1234/api/users"
      },
      mounted() {
        this.getUsers();
      },
      methods: {
        async getUsers() {
          const res = await axios.get(this.apiUrl);
          this.users = res.data;
        },
        async addUser() {
          if (!this.form.name || !this.form.email) {
            alert("Name & Email wajib diisi!");
            return;
          }
          await axios.post(this.apiUrl, this.form);
          this.form = { name: '', email: '', age: '' };
          this.getUsers();
        },
        editUser(user) {
          this.isEdit = true;
          this.editId = user._id;
          this.form = { name: user.name, email: user.email, age: user.age };
        },
        async updateUser() {
          await axios.put(`${this.apiUrl}/${this.editId}`, this.form);
          this.cancelEdit();
          this.getUsers();
        },
        async deleteUser(id) {
          if (confirm("Yakin hapus user ini?")) {
            await axios.delete(`${this.apiUrl}/${id}`);
            this.getUsers();
          }
        },
        cancelEdit() {
          this.isEdit = false;
          this.editId = null;
          this.form = { name: '', email: '', age: '' };
        }
      }
    });
  </script>
</body>
</html>
